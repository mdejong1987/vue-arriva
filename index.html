<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arriva Bus Times</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>
    <div id="app">
        {{getData}}

        <div class="container">
            <div v-for="bus in toCentral">
                <div v-if="bus.ExpectedArrivalTime == bus.TargetArrivalTime">
                    {{ formatDate(bus.TargetArrivalTime) }}
                </div>
                <div v-else>
                    <s>{{ formatDate(bus.TargetArrivalTime) }}</s>
                    {{ formatDate(bus.ExpectedArrivalTime) }}
                </div>
                Status: {{translate(bus.TripStopStatus)}}
                Naar: {{bus.DestinationName50}}
                Lijn: {{bus.LinePublicNumber}}
            </div>
            <hr>
            <div v-for="bus in toRoute">
                <div v-if="bus.ExpectedArrivalTime == bus.TargetArrivalTime">
                    {{ formatDate(bus.TargetArrivalTime) }}
                </div>
                <div v-else>
                    <s>{{ formatDate(bus.TargetArrivalTime) }}</s>
                    {{ formatDate(bus.ExpectedArrivalTime) }}
                </div>
                Status: {{translate(bus.TripStopStatus)}}
                Naar: {{bus.DestinationName50}}
                Lijn: {{bus.LinePublicNumber}}
            </div>
        </div>
        
    </div>
    <script>
        Vue.createApp({
            data(){
                return {
                    toCentral: {},
                    toRoute: {}
                }
            },
            computed: {    
                getData() {
                    const url = 'https://v0.ovapi.nl/stopareacode/BdOud';
                    let options = {
                        method: 'GET'
                    }
                    let response = fetch(url, options).then((response) => response.json()).then((data) => {
                        this.toCentral = Object.values(data.BdOud[72000640].Passes).sort((a, b) => a.TargetArrivalTime.localeCompare(b.TargetArrivalTime));
                        this.toRoute = Object.values(data.BdOud[72000810].Passes).sort((a, b) => a.TargetArrivalTime.localeCompare(b.TargetArrivalTime));
                    });
                }
            },
            methods: {
                formatDate(value){
                    return new Date(value).toLocaleTimeString('nl-NL', { hour: '2-digit', minute:'2-digit', second:'2-digit' });
                },
                translate(status) {
                    let translatedStatus;

                    switch (status) {
                    case 'PLANNED':
                        translatedStatus = 'Gepland';
                        break;
                    case 'PASSED':
                        translatedStatus = 'Gepasseerd';
                        break;
                    case 'CANCEL':
                        translatedStatus = 'Geannuleerd';
                        break;
                    case 'DRIVING':
                        translatedStatus = 'Rijden';
                        break;
                    default:
                        translatedStatus = 'Onbekend'; // Default translation for unknown status
                    }

                    return translatedStatus;
                },
            }
        }).mount('#app');
    </script>
</body>
</html>